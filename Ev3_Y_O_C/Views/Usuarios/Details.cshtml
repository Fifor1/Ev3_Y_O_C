@model Ev3_Y_O_C.Models.Usuario

@{
    ViewData["Title"] = "Detalles";
}

<h1>Detalles</h1>

<div>
    <h4>Usuario</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Nombre)
        </dt>
        <dd class="col-sm-10" id="nombreUsuario">
            @Html.DisplayFor(model => model.Nombre)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Email)
        </dt>
        <dd class="col-sm-10" id="emailUsuario">
            @Html.DisplayFor(model => model.Email)
        </dd>
    </dl>
</div>

<div>
    <a asp-action="Edit" asp-route-id="@Model?.Id">Editar</a> |
    <a asp-action="Index">Volver a la lista</a> |
    <button id="btnRefreshDetails" class="btn btn-secondary">Refrescar Detalles</button> <!-- Botón para refrescar -->
</div>

<div id="resultado" class="mt-3"></div>
<div id="overlay" style="display:none;">Cargando...</div> <!-- Overlay -->
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        $(document).ready(function () {
            $('#btnRefreshDetails').on('click', function () {
                $('#overlay').show(); // Mostrar overlay

                $.ajax({
                    url: '@Url.Action("GetDetails", "Usuarios", new { id = Model.Id })', // URL para obtener los detalles
                    type: 'GET',
                    success: function (data) {
                        // Actualizar los detalles en la página
                        $('#nombreUsuario').text(data.Nombre);
                        $('#emailUsuario').text(data.Email);
                        $('#resultado').html('<div class="alert alert-success">Detalles actualizados con éxito.</div>');
                    },
                    error: function () {
                        $('#resultado').html('<div class="alert alert-danger">Hubo un error al obtener los detalles.</div>');
                    },
                    complete: function () {
                        $('#overlay').hide(); // Ocultar overlay
                    }
                });
            });
        });
    </script>
}
