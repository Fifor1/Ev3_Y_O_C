@model IEnumerable<Ev3_Y_O_C.Models.Usuario>

@{
    ViewData["Title"] = "Index";
}

<h1>Usuarios</h1>

<p>
    <a asp-action="Create">Crear Nuevo Usuario</a>
</p>

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Nombre)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Email)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody id="usuariosTableBody">
        <!-- Datos cargados dinámicamente por AJAX -->
    </tbody>
</table>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            cargarUsuarios();

            function cargarUsuarios() {
                $.ajax({
                    url: '@Url.Action("GetUsuarios", "Usuario")',
                    type: 'GET',
                    success: function (data) {
                        var tableBody = $('#usuariosTableBody');
                        tableBody.empty();

                        data.forEach(function(usuario) {
                            var row = '<tr>' +
                                '<td>' + usuario.nombre + '</td>' +
                                '<td>' + usuario.email + '</td>' +
                                '<td>' +
                                    '<a href="/Usuario/Edit/' + usuario.id + '">Edit</a> | ' +
                                    '<a href="/Usuario/Details/' + usuario.id + '">Details</a> | ' +
                                    '<a href="/Usuario/Delete/' + usuario.id + '">Delete</a>' +
                                '</td>' +
                                '</tr>';
                            tableBody.append(row);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error("Error al cargar los usuarios:", error);
                    }
                });
            }
        });
    </script>
}
