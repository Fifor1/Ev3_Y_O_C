@model Ev3_Y_O_C.Models.Usuario

@{
    ViewData["Title"] = "Eliminar";
}

<h1>Eliminar</h1>

<h3>¿Está seguro de que desea eliminar este usuario?</h3>
<div>
    <h4>Usuario</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Nombre)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Nombre)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Email)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Email)
        </dd>
    </dl>

    <input type="hidden" id="usuarioId" value="@Model.Id" />
    <button id="deleteButton" class="btn btn-danger">Eliminar</button> |
    <a asp-action="Index">Volver a la lista</a>
</div>

<div id="resultado" class="mt-3"></div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        // Script AJAX para eliminar el usuario
        $('#deleteButton').on('click', function (event) {
            event.preventDefault(); // Prevenir el comportamiento predeterminado del botón

            var usuarioId = $('#usuarioId').val(); // Obtener el ID del usuario

            // Confirmar eliminación
            if (confirm('¿Está seguro de que desea eliminar a este usuario?')) {
                $.ajax({
                    url: '@Url.Action("Delete", "Usuarios")',
                    type: 'POST',
                    data: { id: usuarioId },
                    success: function (data) {
                        if (data.success) {
                            $('#resultado').html('<div class="alert alert-success">¡Usuario eliminado con éxito!</div>');
                            setTimeout(function () {
                                window.location.href = '@Url.Action("Index", "Usuarios")'; // Redirigir a la lista
                            }, 2000);
                        } else {
                            $('#resultado').html('<div class="alert alert-danger">Error: ' + data.message + '</div>');
                        }
                    },
                    error: function () {
                        $('#resultado').html('<div class="alert alert-danger">Ocurrió un error al eliminar el usuario.</div>');
                    }
                });
            }
        });
    </script>
}
